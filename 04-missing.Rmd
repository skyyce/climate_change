# Missing values
There is no missing values found from our data source. Here we use steak survey dataset for analysis.

```{r}
plot_missing <- function(b,percent=FALSE){
  library(tidyverse)
  library(patchwork)
  dt1 <-  as.data.frame(colSums(apply(b,2,is.na)))
  colnames(dt1) <- "num"
  dt1 <- arrange(dt1,desc(num))
  dt1$x <- rownames(dt1)
  dt1$x <- factor(dt1$x,levels = dt1$x,labels=dt1$x) 
  
  p1 <- ggplot(dt1 ,aes(x = x,y =num))+geom_bar(stat = "identity",fill = "lightblue")+
    ylab("num rows\nmissing:")+
    xlab("")+
    ggtitle("Missing value patterns")+
    theme_bw()+
    theme(panel.grid.major.x  = element_blank())+
    scale_y_continuous(breaks = c(0,10,20))
  
  p1_ <- ggplot(dt1 ,aes(x = x,y =(num/nrow(b))*100))+geom_bar(stat = "identity",fill = "lightblue")+
    ylab("% rows\nmissing:")+
    xlab("")+
    ggtitle("Missing value patterns")+
    theme_bw()+
    theme(panel.grid.major.x  = element_blank())+
    ylim(0,100)
  
  missing_patterns <- data.frame(is.na(b)) %>%
    group_by_all() %>%
    count(name = "count", sort = TRUE) %>%
    ungroup()
  
  dt2 <- missing_patterns
  dt2$z <- ifelse(rowSums(dt2) == dt2$count,"yes","no")
  dt2$y <- as.factor(rownames(dt2))
  dt2$y <- factor(dt2$y,levels=rev(dt2$y))
  
  
  dt3 <- gather(dt2,-y,-count,-z,key="key",value="value")
  dt3$key <- factor(dt3$key,levels = dt1$x)
  
  p2 <- ggplot(dt3,aes(key,y,fill=value))+geom_tile(aes(alpha =z) ,colour="white")+
    ylab("missing pattern")+
    xlab("variable")+
    scale_fill_manual(values = c("grey","purple"))+
    scale_alpha_manual(values = c(0.4,0.9))+
    annotate("text",x=ncol(b)/2,y=which(rev(dt2$z)=="yes"),label = "complete cases")+
    theme(legend.position = "none")
  
  
  p3 <- ggplot(dt2,aes(count,y))+geom_bar(stat = "identity",fill = "lightblue")+
    ylab("")+
    xlab("row count")+
    xlim(0,max(dt3$count))+
    theme_bw()+
    theme(panel.grid.major.y  = element_blank())
  p3_ <- ggplot(dt2,aes((count/nrow(b))*100,y))+geom_bar(stat = "identity",fill = "lightblue")+
    ylab("")+
    xlab("% rows")+
    xlim(0,100)+
    theme_bw()+
    theme(panel.grid.major.y  = element_blank())
  
  area1 <- area(1,1,1,3)
  area2 <- area(1,4,1,4)
  area3 <- area(2,1,4,3)
  area4 <- area(2,4,4,4)
  areas <- c(area1,area2,area3,area4)
  if (percent == FALSE) {
    print((p1 + plot_spacer()+ p2 + p3) + plot_layout(design = areas))
  }else{
    print((p1_ + plot_spacer()+ p2 + p3_) + plot_layout(design = areas))
  }
}
```


## Analysis

We first load our steak survey data which has 550 observation with 14 columns. (First column is the Respondent ID so we set it as row names)
```{r}
library('fivethirtyeight')
steak_survey = as.data.frame(steak_survey) 
ss = data.frame(steak_survey[,-1], row.names=steak_survey[,1])
print(dim(ss))
```

### Missing counts by column
```{r}
library(tidyverse)
colSums(is.na(ss)) %>%
  sort(decreasing = TRUE)
```
In the survey a lot of respondent did not provide their income and steak preference. The missing values from household income may stem from people's privacy concern. As for the steak preference column, some people may not be steak eater and therefore cannot provide a informative response.

### Missing counts by row
```{r}
rowSums(is.na(ss))[rowSums(is.na(ss))>0] %>% 
  sort(decreasing = TRUE)
```
Based on the missing counts by row, we can see that most of the respondents answer all the questions. Only a few refuse to answer most of the questions. And there are about 20% of respondent has one response missing. It may be the result of missing value from column 'steak_prep' and 'hhold_income'

### Row / column missing patterns from heatmap
```{r}
library(mi)
ss_df <- as.data.frame(ss)
x <- missing_data.frame(ss_df)
image(x)
```
From the plot above we can see some strong pattern correltion between varialbe 'steak' and the missingness of variable 'steak_prep'. There is no description for the column 'steak', based on this corrlation, we inspect it as an indicator on whether the respondent is a steak eater or not. 

### Missing Partern Investigation
```{r fig.height = 9, fig.width = 15}
plot_missing(ss)
```
There are total 22 missing patterns found in the steak survey dataset. 

1. We see that most of the observation is complete. 
2. The two most common missing pattern are caused by the missing of steak preference and househould income. We can see that there is no strong correlation between the missingness of 'steak preference' and 'household income'. 
3. The sixth missing pattern is quite intersting, a few people only respond the question 'lotter_a'. From the description of the data, we suspect that it is probably the first question in the survey, those respondents probably get inpatient and abondon the survey. 
4. For the seventh missing pattern, the respondents only finish first part of the survey, those question that may contain their personal information are missing, those respondents may hold some privacy concern on this survey.

## Summary
Based on the above analysis, we should probably discard datapoints from those 'impatient' respondent and they contain no information. Moreover, those respondents who refuse to answer any personal questions may also be discarded, as they contribute nothing to our analysis of steak preference. For the missing value from steak_prep, they can probably be considered as a new class, which is 'unsure/no preference'. And for the household income column, the majority of the data are still present, and they might be a informative column to predict the steak preference, we may use some technique to impute the values.